<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Villalicores - Panel & Tienda</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #e67e22;
            --secondary: #2c3e50;
            --bg-light: #f4f7f6;
            --white: #ffffff;
            --success: #2ecc71;
            --warning: #f1c40f;
            --danger: #e74c3c;
            --text-gray: #7f8c8d;
        }
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background-color: var(--bg-light); color: #333; }
        
        /* HEADER */
        header { background-color: var(--secondary); color: white; padding: 1.5rem; text-align: center; }
        header h1 { margin: 0; font-size: 2.5rem; }
        header p { margin: 10px 0 0; font-size: 1.1rem; letter-spacing: 1px; }
        
        /* CONTENEDOR */
        .container { max-width: 1200px; margin: 20px auto; padding: 0 20px; }

        /* --- ESTILOS ADMIN --- */
        #admin-section { display: none; padding-bottom: 50px; }
        .admin-header { display: flex; align-items: center; margin-bottom: 20px; gap: 15px; }
        .logo-admin { background: var(--primary); color: white; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-size: 1.2rem; }

        /* Stats Cards */
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 20px; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 10px rgba(0,0,0,0.03); border: 1px solid #eee; }
        .stat-info h4 { margin: 0; color: var(--text-gray); font-size: 0.9rem; font-weight: normal; }
        .stat-info p { margin: 5px 0 0; font-size: 1.8rem; font-weight: bold; color: var(--secondary); }
        .stat-icon { width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.2rem; }
        
        /* Tabs */
        .admin-tabs { margin-bottom: 20px; }
        .tab-btn { background: white; border: 1px solid #ddd; padding: 10px 20px; border-radius: 6px; cursor: pointer; margin-right: 10px; font-weight: 600; color: var(--text-gray); transition: 0.3s; }
        .tab-btn.active { background: #e6e6e6; color: var(--secondary); border-color: #ccc; }
        .tab-content { display: none; }
        .tab-content.active { display: block; animation: fadeIn 0.5s; }

        /* TABLA INVENTARIO */
        .inventory-card { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .inventory-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-add { background-color: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        
        table { width: 100%; border-collapse: collapse; }
        th { text-align: left; padding: 15px; color: var(--text-gray); border-bottom: 2px solid #eee; font-size: 0.9rem; }
        td { padding: 15px; border-bottom: 1px solid #eee; vertical-align: middle; }
        .prod-flex { display: flex; align-items: center; gap: 15px; font-weight: 600; }
        .prod-thumb { width: 40px; height: 40px; border-radius: 8px; object-fit: cover; background: #eee; }
        .badge { padding: 5px 10px; border-radius: 15px; font-size: 0.8rem; font-weight: bold; }
        .badge-active { background: #d4edda; color: #155724; }
        .badge-cat { background: white; border: 1px solid #ddd; color: #666; }
        .actions-cell i { cursor: pointer; margin: 0 8px; font-size: 1.1rem; transition: 0.2s; }
        .actions-cell i:hover { transform: scale(1.2); }

        /* PEDIDOS */
        .orders-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap: 20px; }
        .order-card { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); border: 1px solid #eee; position: relative; }
        .order-header-main { display: flex; justify-content: space-between; margin-bottom: 10px; padding-bottom:10px; border-bottom:1px dashed #eee; }
        .order-code { font-weight: bold; color: var(--primary); font-size: 1.1rem; }
        .order-total { font-size: 1.3rem; font-weight: bold; color: var(--primary); }
        .order-client-info p { margin: 6px 0; color: #555; display: flex; align-items: center; gap: 10px; font-size: 0.95rem; }
        .status-badge { padding: 4px 10px; border-radius: 4px; font-size: 0.8rem; font-weight: bold; display: inline-block; margin-left: 10px; }
        .st-pendiente { background: #fff3cd; color: #856404; }
        .st-confirmado { background: #d1ecf1; color: #0c5460; }
        .st-entregado { background: #d4edda; color: #155724; }
        .st-cancelado { background: #f8d7da; color: #721c24; }
        .status-select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-top: 10px; background: white; cursor: pointer; }

        /* TIENDA CLIENTE */
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); gap: 25px; margin-top: 30px; }
        .client-card { background: white; border-radius: 15px; overflow: hidden; box-shadow: 0 5px 15px rgba(0,0,0,0.05); transition: transform 0.3s; }
        .client-card:hover { transform: translateY(-5px); }
        .client-img { width: 100%; height: 200px; object-fit: contain; padding: 10px; background: white; }
        .client-info { padding: 15px; text-align: center; }
        .add-btn { background: var(--secondary); color: white; border: none; padding: 10px; width: 100%; border-radius: 8px; cursor: pointer; font-weight: bold; margin-top: 10px; }

        /* MODALES */
        .cart-float { position: fixed; bottom: 30px; right: 30px; background: var(--primary); color: white; width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer; box-shadow: 0 5px 20px rgba(230, 126, 34, 0.4); z-index: 100; }
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 200; align-items: center; justify-content: center; }
        .modal-box { background: white; padding: 30px; width: 90%; max-width: 500px; border-radius: 12px; max-height: 90vh; overflow-y: auto; }
        input, textarea { width: 100%; padding: 10px; margin: 5px 0 15px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box; }

        .admin-trigger { position: fixed; bottom: 10px; left: 10px; font-size: 0.8rem; color: #ccc; cursor: pointer; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

<header>
    <h1>üç∑ Villalicores</h1>
    <p>TU ELECCI√ìN EN CADA BOTELLA.</p>
</header>

<div class="container">
    
    <div id="admin-section">
        <div class="admin-header">
            <div class="logo-admin"><i class="fas fa-wine-glass-alt"></i></div>
            <div>
                <h2 style="margin:0; color:var(--secondary);">Panel Admin</h2>
                <span style="color:var(--text-gray); font-size:0.9rem;">Gesti√≥n de Villalicores</span>
            </div>
            <div style="margin-left:auto; display:flex; gap:10px;">
                <button onclick="exportData()" style="border:1px solid #2ecc71; background:white; color:#2ecc71; padding:5px 10px; border-radius:5px; cursor:pointer;">üíæ Guardar Copia</button>
                <button onclick="importData()" style="border:1px solid #3498db; background:white; color:#3498db; padding:5px 10px; border-radius:5px; cursor:pointer;">üìÇ Cargar Copia</button>
                <button onclick="logoutAdmin()" style="border:none; background:none; color:var(--danger); cursor:pointer;">Salir</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-info"><h4>Productos</h4><p id="stat-products">0</p></div>
                <div class="stat-icon" style="background:#fff3cd; color:#f1c40f;"><i class="fas fa-box"></i></div>
            </div>
            <div class="stat-card">
                <div class="stat-info"><h4>Pedidos pendientes</h4><p id="stat-orders">0</p></div>
                <div class="stat-icon" style="background:#e8f8f5; color:#3498db;"><i class="fas fa-shopping-bag"></i></div>
            </div>
            <div class="stat-card">
                <div class="stat-info"><h4>Ventas totales</h4><p id="stat-sales" style="color:#27ae60;">‚Ç°0</p></div>
                <div class="stat-icon" style="background:#d4edda; color:#2ecc71;"><i class="fas fa-dollar-sign"></i></div>
            </div>
        </div>

        <div class="admin-tabs">
            <button class="tab-btn active" onclick="switchTab('products')"><i class="fas fa-boxes"></i> Productos</button>
            <button class="tab-btn" onclick="switchTab('orders')"><i class="fas fa-receipt"></i> Pedidos</button>
        </div>

        <div id="tab-products" class="tab-content active">
            <div class="inventory-card">
                <div class="inventory-header">
                    <h3 style="margin:0;">Inventario de productos</h3>
                    <button class="btn-add" onclick="openProductForm()"><i class="fas fa-plus"></i> Nuevo producto</button>
                </div>
                
                <div id="product-form" style="display:none; background:#f9f9f9; padding:20px; border-radius:8px; margin-bottom:20px; border:1px solid #eee;">
                    <h4 id="form-title" style="margin-top:0;">Datos del Producto</h4>
                    <input type="hidden" id="prodId">
                    <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
                        <input type="text" id="prodName" placeholder="Nombre">
                        <input type="text" id="prodCat" placeholder="Categor√≠a">
                        <input type="number" id="prodPrice" placeholder="Precio">
                        <input type="number" id="prodStock" placeholder="Stock">
                    </div>
                    
                    <label style="font-size:0.8rem; font-weight:bold;">URL de la Imagen (Link):</label>
                    <input type="url" id="prodImg" placeholder="https://ejemplo.com/imagen.jpg">
                    
                    <div style="display:flex; gap:10px;">
                        <button onclick="saveProduct()" class="btn-add" style="flex:1;">Guardar</button>
                        <button onclick="document.getElementById('product-form').style.display='none'" style="background:#ddd; border:none; padding:10px; border-radius:6px; cursor:pointer;">Cancelar</button>
                    </div>
                </div>

                <div style="overflow-x:auto;">
                    <table>
                        <thead>
                            <tr><th>Producto</th><th>Categor√≠a</th><th>Precio</th><th>Stock</th><th>Estado</th><th>Acciones</th></tr>
                        </thead>
                        <tbody id="admin-table-body"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="tab-orders" class="tab-content">
            <h3 style="margin-bottom:20px; color:var(--secondary);">Gesti√≥n de Pedidos</h3>
            <div id="orders-list" class="orders-grid"></div>
        </div>
    </div>

    <div id="shop-section">
        <div class="products-grid" id="catalog"></div>
    </div>
</div>

<div class="cart-float" onclick="openCartModal()">
    <i class="fas fa-shopping-cart"></i>
    <span id="cart-count" style="position:absolute; top:0; right:0; background:red; font-size:0.7rem; width:20px; height:20px; border-radius:50%; display:flex; align-items:center; justify-content:center; border:2px solid white;">0</span>
</div>

<div id="cartModal" class="modal">
    <div class="modal-box">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2>Tu Pedido</h2>
            <button onclick="clearCart()" style="background:var(--danger); color:white; border:none; padding:5px 10px; border-radius:5px; cursor:pointer; font-size:0.8rem;">
                <i class="fas fa-trash"></i> Vaciar
            </button>
        </div>
        
        <div id="cart-items"></div>
        <h3 style="text-align:right; color:var(--primary);">Total: ‚Ç°<span id="cart-total">0</span></h3>
        <p style="background:#e8f8f5; color:#1abc9c; padding:10px; border-radius:5px; font-size:0.9rem;">
            <i class="fas fa-truck"></i> Entrega estimada: <span id="delivery-msg"></span>
        </p>
        
        <h4>Datos de Env√≠o</h4>
        <input type="text" id="cName" placeholder="Nombre Completo" required>
        <input type="tel" id="cPhone" placeholder="Tel√©fono (Ej: 88889999)" required>
        <textarea id="cAddress" placeholder="Direcci√≥n exacta en la GAM" rows="3" required></textarea>
        
        <button onclick="finalizeOrder()" class="btn-add" style="width:100%; font-size:1.1rem;">
            <i class="fab fa-whatsapp"></i> Enviar Pedido
        </button>
        <button onclick="closeModal()" style="width:100%; margin-top:10px; background:white; border:none; color:#777; cursor:pointer;">Cerrar</button>
    </div>
</div>

<div id="loginModal" class="modal">
    <div class="modal-box" style="max-width:350px; text-align:center;">
        <div style="background:#c0392b; color:white; padding:15px; margin:-30px -30px 20px -30px; border-radius:12px 12px 0 0; font-weight:bold; font-size:1.1rem;">
            <i class="fas fa-exclamation-triangle"></i> ACCESO RESTRINGIDO
        </div>
        <p>Introduce la clave de administrador para continuar.</p>
        <input type="password" id="adminPassInput" placeholder="Contrase√±a" style="text-align:center;">
        <button onclick="checkLogin()" class="btn-add">Ingresar</button>
        <button onclick="closeLogin()" style="margin-top:10px; background:none; border:none; color:#777; cursor:pointer;">Cancelar</button>
    </div>
</div>

<div class="admin-trigger" onclick="openLogin()">Admin Login</div>

<script>
    // --- 1. CONFIGURACI√ìN ---
    // CAMBIA ESTE N√öMERO POR EL TUYO (C√≥digo pa√≠s + n√∫mero, sin espacios)
    const ADMIN_PHONE = "50672255624"; 

    let products = JSON.parse(localStorage.getItem('myLicoresProducts')) || [
        { id: 1, name: "Johnnie Walker Black Label", category: "Whisky", price: 25000, stock: 14, img: "https://www.johnniewalker.com/en-us/images/static/bottle-black-label.png" },
        { id: 2, name: "Absolut Vodka", category: "Vodka", price: 12000, stock: 20, img: "https://www.absolut.com/wp-content/uploads/absolut-vodka-original-40-700ml-1.png" },
        { id: 3, name: "Ron Flor de Ca√±a 18", category: "Ron", price: 35000, stock: 8, img: "https://flordecana.com/wp-content/uploads/2021/03/FDC_18_Botella-e1617050475688.png" }
    ];

    let orders = JSON.parse(localStorage.getItem('myLicoresOrders')) || [];
    let cart = [];
    
    // --- 2. FUNCIONES BASE ---
    function saveData() {
        localStorage.setItem('myLicoresProducts', JSON.stringify(products));
        localStorage.setItem('myLicoresOrders', JSON.stringify(orders));
        updateStats();
        renderAdmin(); 
        renderShop(); 
    }

    function generateCode() { return 'LC-' + Math.random().toString(36).substr(2, 6).toUpperCase(); }
    
    function getNextWeekDate() {
        const d = new Date(); d.setDate(d.getDate() + 7);
        return d.toLocaleDateString('es-ES', { day: 'numeric', month: 'long', year: 'numeric' });
    }

    // --- 3. TIENDA CLIENTE ---
    function renderShop() {
        const grid = document.getElementById('catalog');
        grid.innerHTML = products.map(p => `
            <div class="client-card">
                <img src="${p.img}" class="client-img" onerror="this.src='https://via.placeholder.com/150?text=Sin+Imagen'">
                <div class="client-info">
                    <h3 style="margin:5px 0; font-size:1rem;">${p.name}</h3>
                    <h4 style="color:var(--primary); font-size:1.2rem; margin:10px 0;">‚Ç°${p.price.toLocaleString()}</h4>
                    <button class="add-btn" onclick="addToCart(${p.id})">Agregar</button>
                </div>
            </div>
        `).join('');
        document.getElementById('delivery-msg').innerText = getNextWeekDate();
    }

    function addToCart(id) {
        const p = products.find(x => x.id === id);
        const exists = cart.find(c => c.id === id);
        if(exists) exists.qty++; else cart.push({...p, qty: 1});
        updateCartCount();
        alert("Producto agregado");
    }

    function updateCartCount() {
        document.getElementById('cart-count').innerText = cart.reduce((s, i) => s + i.qty, 0);
    }

    function clearCart() {
        if(confirm("¬øSeguro que quieres vaciar el carrito?")) {
            cart = [];
            updateCartCount();
            closeModal();
            alert("Carrito vaciado");
        }
    }

    function openCartModal() {
        document.getElementById('cartModal').style.display = 'flex';
        let total = 0;
        document.getElementById('cart-items').innerHTML = cart.map(i => {
            const freshProd = products.find(p => p.id === i.id) || i;
            total += freshProd.price * i.qty;
            return `
                <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">
                    <div>
                        <span style="font-weight:bold;">${i.qty}x</span> ${freshProd.name}
                        <div style="font-size:0.8rem; color:#888;">Precio unit: ‚Ç°${freshProd.price.toLocaleString()}</div>
                    </div>
                    <strong>‚Ç°${(freshProd.price * i.qty).toLocaleString()}</strong>
                </div>`;
        }).join('');
        document.getElementById('cart-total').innerText = total.toLocaleString();
    }
    
    function closeModal() { document.getElementById('cartModal').style.display = 'none'; }

    // --- 4. PROCESO DE PEDIDO ---
    function finalizeOrder() {
        const name = document.getElementById('cName').value;
        const phone = document.getElementById('cPhone').value;
        const address = document.getElementById('cAddress').value;

        if(!name || !phone || !address || cart.length === 0) {
            alert("Completa todos los datos"); return;
        }

        const code = generateCode();
        const deliveryDate = getNextWeekDate();
        let total = 0;
        const finalItems = cart.map(i => {
            const freshProd = products.find(p => p.id === i.id) || i;
            total += freshProd.price * i.qty;
            return { ...freshProd, qty: i.qty };
        });
        
        const newOrder = {
            code, name, phone, address, 
            items: finalItems, total, deliveryDate,
            status: "Pendiente",
            date: new Date().toLocaleDateString('es-ES')
        };
        orders.unshift(newOrder);
        saveData();

        let msg = `üç∑ *NUEVO PEDIDO WEB* üç∑\n`;
        msg += `--------------------------------\n`;
        msg += `üßæ *C√≥digo:* ${code}\n`;
        msg += `üë§ *Cliente:* ${name}\n`;
        msg += `üìû *Tel:* ${phone}\n`;
        msg += `üìç *Direcci√≥n:* ${address}\n`;
        msg += `--------------------------------\n`;
        msg += `*Pedido:*\n`;
        finalItems.forEach(i => msg += `- ${i.qty}x ${i.name}\n`);
        msg += `\nüí∞ *TOTAL: ‚Ç°${total.toLocaleString()}*\n`;
        
        const url = `https://wa.me/${ADMIN_PHONE}?text=${encodeURIComponent(msg)}`;
        
        cart = []; updateCartCount(); closeModal();
        window.open(url, '_blank');
    }

    // --- 5. ADMIN PANEL Y LOGIN ---
    
    function openLogin() {
        document.getElementById('loginModal').style.display = 'flex';
        document.getElementById('adminPassInput').value = '';
        document.getElementById('adminPassInput').focus();
    }

    function closeLogin() {
        document.getElementById('loginModal').style.display = 'none';
    }

    function checkLogin() {
        const pass = document.getElementById('adminPassInput').value;
        // üîê CONTRASE√ëA: 7894
        if(pass === "7894") {
            closeLogin();
            document.getElementById('admin-section').style.display = 'block';
            document.getElementById('shop-section').style.display = 'none';
            renderAdmin();
        } else {
            alert("Contrase√±a incorrecta");
        }
    }

    function logoutAdmin() {
        document.getElementById('admin-section').style.display = 'none';
        document.getElementById('shop-section').style.display = 'grid';
    }

    function switchTab(t) {
        document.querySelectorAll('.tab-content').forEach(d => d.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('tab-' + t).classList.add('active');
        // Usamos event.currentTarget o buscamos el bot√≥n activo manualmente si es necesario
        if(event && event.currentTarget) event.currentTarget.classList.add('active');
    }

    function renderAdmin() {
        updateStats();

        // Tabla Productos (Con protecci√≥n de imagen)
        document.getElementById('admin-table-body').innerHTML = products.map(p => `
            <tr>
                <td>
                    <div class="prod-flex">
                        <img src="${p.img}" class="prod-thumb" onerror="this.src='https://via.placeholder.com/40?text=Error'">
                        ${p.name}
                    </div>
                </td>
                <td><span class="badge badge-cat">${p.category}</span></td>
                <td>‚Ç°${p.price.toLocaleString()}</td>
                <td><span class="badge" style="background:#e8f6f3; color:#1abc9c">${p.stock}</span></td>
                <td><span class="badge badge-active">Activo</span></td>
                <td class="actions-cell">
                    <i class="fas fa-pen" style="color:#f1c40f" onclick="editProd(${p.id})" title="Editar"></i>
                    <i class="fas fa-trash" style="color:#e74c3c" onclick="deleteProd(${p.id})" title="Eliminar"></i>
                </td>
            </tr>
        `).join('');

        // Lista Pedidos
        const orderList = document.getElementById('orders-list');
        if(orders.length === 0) orderList.innerHTML = '<p>No hay pedidos.</p>';
        else {
            orderList.innerHTML = orders.map((o, idx) => {
                let badgeClass = 'st-pendiente';
                if(o.status === 'Confirmado') badgeClass = 'st-confirmado';
                if(o.status === 'Entregado') badgeClass = 'st-entregado';
                if(o.status === 'Cancelado') badgeClass = 'st-cancelado';

                return `
                <div class="order-card">
                    <div class="order-header-main">
                        <div>
                            <div class="order-code">${o.code} <span class="status-badge ${badgeClass}">${o.status}</span></div>
                            <small>${o.date}</small>
                        </div>
                        <div class="order-total">‚Ç°${o.total.toLocaleString()}</div>
                    </div>
                    <div class="order-client-info">
                        <p><i class="fas fa-user"></i> ${o.name}</p>
                        <p><i class="fas fa-phone"></i> ${o.phone}</p>
                        <p><i class="fas fa-map-marker-alt"></i> ${o.address}</p>
                        <p><i class="far fa-calendar-alt"></i> Entrega: ${o.deliveryDate}</p>
                    </div>
                    
                    <div style="background:#f8f9fa; padding:10px; border-radius:8px; font-size:0.9rem;">
                        ${o.items.map(i => `<div>${i.qty}x ${i.name}</div>`).join('')}
                    </div>

                    <label style="font-size:0.8rem; color:#888; margin-top:10px; display:block;">Cambiar estado:</label>
                    <select class="status-select" onchange="updateOrderStatus(${idx}, this.value)">
                        <option value="Pendiente" ${o.status === 'Pendiente' ? 'selected' : ''}>Pendiente</option>
                        <option value="Confirmado" ${o.status === 'Confirmado' ? 'selected' : ''}>Confirmado</option>
                        <option value="Entregado" ${o.status === 'Entregado' ? 'selected' : ''}>Entregado</option>
                        <option value="Cancelado" ${o.status === 'Cancelado' ? 'selected' : ''}>Cancelado</option>
                    </select>

                    <button onclick="sendConfirmationToClient(${idx})" 
                            style="width:100%; margin-top:10px; background:#25D366; color:white; border:none; padding:12px; border-radius:6px; cursor:pointer; font-weight:bold; display:flex; align-items:center; justify-content:center; gap:8px;">
                        <i class="fab fa-whatsapp" style="font-size:1.2rem;"></i> Enviar Confirmaci√≥n al Cliente
                    </button>
                </div>
            `}).join('');
        }
    }

    // --- 6. GESTI√ìN INVENTARIO ---
    
    function openProductForm() { 
        document.getElementById('product-form').style.display = 'block'; 
        document.getElementById('form-title').innerText = "Nuevo Producto";
        document.getElementById('prodId').value = ""; 
        document.getElementById('prodName').value = "";
        document.getElementById('prodCat').value = "";
        document.getElementById('prodPrice').value = "";
        document.getElementById('prodStock').value = "";
        document.getElementById('prodImg').value = "";
    }

    function editProd(id) {
        const p = products.find(x => x.id === id);
        if(!p) return;
        document.getElementById('product-form').style.display = 'block';
        document.getElementById('form-title').innerText = "Editar Producto";
        document.getElementById('prodId').value = p.id;
        document.getElementById('prodName').value = p.name;
        document.getElementById('prodCat').value = p.category;
        document.getElementById('prodPrice').value = p.price;
        document.getElementById('prodStock').value = p.stock;
        document.getElementById('prodImg').value = p.img;
        document.getElementById('product-form').scrollIntoView({ behavior: 'smooth' });
    }

    function saveProduct() {
        const id = document.getElementById('prodId').value;
        const name = document.getElementById('prodName').value;
        const cat = document.getElementById('prodCat').value;
        const price = Number(document.getElementById('prodPrice').value);
        const stock = Number(document.getElementById('prodStock').value);
        const img = document.getElementById('prodImg').value || 'https://via.placeholder.com/150?text=Sin+Imagen';

        if(!name || !cat || !price) { alert("Llena los campos necesarios"); return; }

        if (id) {
            const index = products.findIndex(p => p.id == id);
            if (index !== -1) {
                products[index] = { id: Number(id), name, category: cat, price, stock, img };
                alert("Producto actualizado");
            }
        } else {
            products.push({ id: Date.now(), name, category: cat, price, stock, img });
            alert("Producto creado");
        }

        document.getElementById('product-form').style.display = 'none';
        saveData();
    }

    function deleteProd(id) {
        if(confirm("¬øEliminar producto?")) { products = products.filter(p => p.id !== id); saveData(); }
    }

    function sendConfirmationToClient(idx) {
        const o = orders[idx];
        const cleanPhone = o.phone.replace(/\D/g, '');
        let msg = `*LICORER√çA - Confirmaci√≥n de Pedido*\n\n`;
        msg += `Hola ${o.name}!\n\n`;
        msg += `Tu pedido ha sido confirmado.\n\n`;
        msg += `üßæ *C√≥digo de compra:* ${o.code}\n`;
        msg += `üí∞ *Total:* ‚Ç°${o.total.toLocaleString()}\n`;
        msg += `üöö *Entrega m√°xima:* ${o.deliveryDate}`;
        window.open(`https://wa.me/506${cleanPhone}?text=${encodeURIComponent(msg)}`, '_blank');
    }

    function updateOrderStatus(idx, val) {
        orders[idx].status = val;
        saveData();
    }

    function updateStats() {
        document.getElementById('stat-products').innerText = products.length;
        document.getElementById('stat-orders').innerText = orders.filter(o => o.status === 'Pendiente').length;
        const total = orders.reduce((s, o) => s + o.total, 0);
        document.getElementById('stat-sales').innerText = '‚Ç°' + total.toLocaleString();
    }

    renderShop();
</script>

</body>
</html>